<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sample the Twitter Graph and Cache It Locally • twittercache</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/paper/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Sample the Twitter Graph and Cache It Locally">
<meta property="og:description" content="Facilitates robust sampling of the Twitter graph by saving
  data about observed nodes into a data cache. Requests for new nodes are
  smart and do not waste API requests on nodes already in the cache. The
  cache can then be exported to a number of data structures more
  appropriate for network analysis. Automatically manages multiple tokens
  to speed up sampling with staying with API rate limits.">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">twittercache</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9002</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/alexpghayes/twittercache">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    

    
    
<!-- README.md is generated from README.Rmd. Please edit that file -->
<div id="twittercache" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#twittercache" class="anchor"></a>twittercache</h1></div>
<!-- badges: start -->

<p><code>twittercache</code> facilitates robust sampling of the Twitter network. The basic idea is to save any data into a local cache as you as you get it. <code>twittercache</code> is build on top of <a href="http://rtweet.info/"><code>rtweet</code></a>.</p>
<div id="names" class="section level2">
<h2 class="hasAnchor">
<a href="#names" class="anchor"></a>NAMES</h2>
<ul>
<li>request queue</li>
<li>failure log</li>
</ul>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>You can install the development version of <code>twittercache</code> with:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/install.packages">install.packages</a></span>(<span class="st">"devtools"</span>)</a>
<a class="sourceLine" id="cb1-2" title="2">devtools<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/devtools/topics/reexports">install_github</a></span>(<span class="st">"alexpghayes/twittercache"</span>)</a></code></pre></div>
<p><code>twittercache</code> is not on CRAN and I don’t plan to submit it.</p>
</div>
<div id="step-1-register-your-tokens" class="section level2">
<h2 class="hasAnchor">
<a href="#step-1-register-your-tokens" class="anchor"></a>Step 1: Register your tokens</h2>
<p>Create a token with <code>rtweet</code> and then register it with <code><a href="reference/register_token.html">register_token()</a></code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(twittercache)</a>
<a class="sourceLine" id="cb2-2" title="2"></a>
<a class="sourceLine" id="cb2-3" title="3">token &lt;-<span class="st"> </span>rtweet<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/rtweet/topics/create_token">create_token</a></span>(</a>
<a class="sourceLine" id="cb2-4" title="4">  <span class="dt">app =</span> <span class="st">"FILL_THIS_IN"</span>,</a>
<a class="sourceLine" id="cb2-5" title="5">  <span class="dt">consumer_key =</span> <span class="st">"FILL_THIS_IN"</span>,</a>
<a class="sourceLine" id="cb2-6" title="6">  <span class="dt">consumer_secret =</span> <span class="st">"FILL_THIS_IN"</span>,</a>
<a class="sourceLine" id="cb2-7" title="7">  <span class="dt">access_token =</span> <span class="st">"FILL_THIS_IN"</span>,</a>
<a class="sourceLine" id="cb2-8" title="8">  <span class="dt">access_secret =</span> <span class="st">"FILL_THIS_IN"</span></a>
<a class="sourceLine" id="cb2-9" title="9">)</a>
<a class="sourceLine" id="cb2-10" title="10"></a>
<a class="sourceLine" id="cb2-11" title="11"><span class="kw"><a href="reference/register_token.html">register_token</a></span>(token)</a></code></pre></div>
<p>Or add existing <code>rtweet</code> tokens with <code>get_token()</code> / <code>get_tokens()</code>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">token &lt;-<span class="st"> </span><span class="kw">get_token</span>()</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="kw"><a href="reference/register_token.html">register_token</a></span>(token)</a></code></pre></div>
<p><code>twittercache</code> is smart and only allows you to register a token once, so don’t worry about accidentally registering the same token multiple times:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="kw"><a href="reference/register_token.html">register_token</a></span>(token)</a></code></pre></div>
<p>Check how many tokens you have registered with</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="kw"><a href="reference/get_number_of_tokens.html">get_number_of_tokens</a></span>()</a></code></pre></div>
</div>
<div id="step-2-request-information-on-nodes-in-the-twitter-graph" class="section level2">
<h2 class="hasAnchor">
<a href="#step-2-request-information-on-nodes-in-the-twitter-graph" class="anchor"></a>Step 2: Request information on nodes in the twitter graph</h2>
<p>Request information on a nodes with <code><a href="reference/request.html">request()</a></code>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw"><a href="reference/request.html">request</a></span>(<span class="st">"alexpghayes"</span>)</a></code></pre></div>
<p>You can pass either screen names or user IDs to <code><a href="reference/request.html">request()</a></code>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(rtweet)</a>
<a class="sourceLine" id="cb7-2" title="2"></a>
<a class="sourceLine" id="cb7-3" title="3">rohe_lab &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"alexpghayes"</span>, <span class="st">"karlrohe"</span>, <span class="st">"krauskae"</span>, <span class="st">"_fchen"</span>,</a>
<a class="sourceLine" id="cb7-4" title="4">              <span class="st">"JosephineLukito"</span>, <span class="st">"yinizhang2011"</span>, <span class="st">"undercoverkanye"</span>)</a>
<a class="sourceLine" id="cb7-5" title="5"></a>
<a class="sourceLine" id="cb7-6" title="6">r_peeps &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"hadleywickham"</span>, <span class="st">"JennyBryan"</span>, <span class="st">"robinson_es"</span>)</a>
<a class="sourceLine" id="cb7-7" title="7"></a>
<a class="sourceLine" id="cb7-8" title="8"><span class="kw"><a href="reference/request.html">request</a></span>(rohe_lab, <span class="dt">neighborhood =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><code>twittercache</code> is really built to enable to BFS type searches through the twitter graph. If you want to add known about all the nodes in the neighborhood of a single node, use:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="kw"><a href="reference/request.html">request</a></span>(<span class="st">"alexpghayes"</span>, <span class="dt">neighborhood =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>I recommend against asking for the neighborhood huge accounts, because <code>twittercache</code> considers both friends and followers part of the neighborhood, and so sampling will take forever if you do things like:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="kw"><a href="reference/request.html">request</a></span>(<span class="st">"hadleywickham"</span>, <span class="dt">neighborhood =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><code><a href="reference/request.html">request()</a></code> <em>does not</em> do any sampling. It just builds a list of nodes that need to be sampled. <code><a href="reference/request.html">request()</a></code> is smart:</p>
<ul>
<li>If a node is already in the cache, it isn’t added to the queue</li>
<li>Redundant nodes are not added to the queue</li>
</ul>
<p>If you request information on a Twitter user that doesn’t exist, you’ll get a warning:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="kw"><a href="reference/request.html">request</a></span>(<span class="st">"not_a_real_twitter_handle"</span>)</a></code></pre></div>
<p>To see the current list of requests, use</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="kw"><a href="reference/get_requests.html">get_requests</a></span>()</a></code></pre></div>
<p>This returns a character vector of user IDs. It’s mostly for internal use at the moment and I might write a nicer wrapper around it that returns screen names at some point.</p>
<p>To clear the current requests, use</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"><span class="kw"><a href="reference/clear_requests.html">clear_requests</a></span>()</a></code></pre></div>
</div>
<div id="step-3-sample-nodes" class="section level2">
<h2 class="hasAnchor">
<a href="#step-3-sample-nodes" class="anchor"></a>Step 3: Sample nodes!</h2>
<p>All you need to do is run</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="kw"><a href="reference/sample_twitter_graph.html">sample_twitter_graph</a></span>()</a></code></pre></div>
<p>For more verbose output, use</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(logger)</a>
<a class="sourceLine" id="cb14-2" title="2"></a>
<a class="sourceLine" id="cb14-3" title="3"><span class="kw">log_level</span>(DEBUG)</a>
<a class="sourceLine" id="cb14-4" title="4"></a>
<a class="sourceLine" id="cb14-5" title="5"><span class="kw"><a href="reference/sample_twitter_graph.html">sample_twitter_graph</a></span>()</a></code></pre></div>
<p>If someone knows better practices for logging things, please reach out, I really have no clue what I’m doing here.</p>
<p>On occasion <code>rtweet()</code> or the Twitter API will just explode and won’t be able to sample a node. <code><a href="reference/sample_twitter_graph.html">sample_twitter_graph()</a></code> records these failures and moves on to the next requested node in cases like this.</p>
<p>To see nodes that <code><a href="reference/sample_twitter_graph.html">sample_twitter_graph()</a></code> managed to sample, run</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1"><span class="kw"><a href="reference/get_failures.html">get_failures</a></span>()</a></code></pre></div>
<p>which again returns a character vector of user IDs.</p>
<p>In general, <code><a href="reference/sample_twitter_graph.html">sample_twitter_graph()</a></code> is designed to be pretty robust. If it crashes the samples you already got are already saved into the cache so you don’t lose work, and if you run it again it’ll update the request list and make sure not to repeat any work.</p>
</div>
<div id="step-4-export-the-cache" class="section level2">
<h2 class="hasAnchor">
<a href="#step-4-export-the-cache" class="anchor"></a>Step 4: Export the cache</h2>
<p>export the cache / import the cache</p>
<p>TODO</p>
</div>
<div id="frequently-asked-questions" class="section level2">
<h2 class="hasAnchor">
<a href="#frequently-asked-questions" class="anchor"></a>Frequently asked questions</h2>
<p><strong>How do you manage the API rate limits?</strong></p>
<p>Currently we just sample one node a minute. This complies with the Twitter API rate limits but is a bit dicey. Improving this is a priority.</p>
<p><strong>Where is the cache itself?</strong></p>
<p>It’s at <code>~/.twittergraph/</code>.</p>
<p><strong>This whole cache thing is a bad idea</strong></p>
<p>Probably, but it works for me.</p>
<p><strong>What about users with big follower counts? Do you sample all the followers?</strong></p>
<p>No. We only sample up to 5,000 friends and 5,000 followers. This is mostly because I’m lazy and also it’s wasteful to spend API calls on someone with tons of followers.</p>
<p>Recall that you can pick up an edge in the network from either node. We recommend trying to make sure the node with smaller degree is in your sample.</p>
<p><strong>What happens when I try to sample protected users?</strong></p>
<p>We remove these users from the sample at export time.</p>
</div>
<div id="todo" class="section level2">
<h2 class="hasAnchor">
<a href="#todo" class="anchor"></a>TODO</h2>
<ul>
<li>just put create_cache_if_needed in user facing functions, and nowhere else</li>
<li>add move <code>force</code> argument from <code>visit</code> to <code>request</code>
</li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/alexpghayes/twittercache">https://​github.com/​alexpghayes/​twittercache</a>
</li>
<li>Report a bug at <br><a href="https://github.com/alexpghayes/twittercache/issues">https://​github.com/​alexpghayes/​twittercache/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Alex Hayes <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-4985-5160" target="orcid.widget"><img src="https://members.orcid.org/sites/default/files/vector_iD_icon.svg" class="orcid" alt="ORCID" height="16"></a> </li>
</ul>
</div>

      <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.org/RoheLab/twittercache"><img src="https://travis-ci.org/RoheLab/twittercache.svg?branch=master" alt="Travis build status"></a></li>
<li><a href="https://travis-ci.org/alexpghayes/twittercache"><img src="https://travis-ci.org/alexpghayes/twittercache.svg?branch=master" alt="Travis build status"></a></li>
</ul>
</div>
</div>

</div>


      <footer><div class="copyright">
  <p>Developed by Alex Hayes.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
