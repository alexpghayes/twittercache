<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sample the Twitter Graph and Cache It Locally • twittercache</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/paper/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Sample the Twitter Graph and Cache It Locally">
<meta property="og:description" content="Facilitates robust sampling of the Twitter graph by saving
  data about observed nodes into a data cache. Requests for new nodes are
  smart and do not waste API requests on nodes already in the cache. The
  cache can then be exported to a number of data structures more
  appropriate for network analysis. Automatically manages multiple tokens
  to speed up sampling with staying with API rate limits.">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">twittercache</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/alexpghayes/twittercache">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    

    
    
<!-- README.md is generated from README.Rmd. Please edit that file -->
<div id="twittercache" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#twittercache" class="anchor"></a>twittercache</h1></div>
<!-- badges: start -->

<p><code>twittercache</code> facilitates robust sampling of the Twitter graph. The basic idea is to save any data into a local cache as you as you get it. <code>twittercache</code> is build on top of <a href="http://rtweet.info/"><code>rtweet</code></a>.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>You can install the development version of <code>twittercache</code> with:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/install.packages">install.packages</a></span>(<span class="st">"devtools"</span>)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">"alexpghayes/twittercache"</span>)</a></code></pre></div>
<p><code>twittercache</code> is not on CRAN and I don’t plan to submit it. If you run into bugs, <strong>please please please</strong> report them.</p>
</div>
<div id="basic-workflow" class="section level2">
<h2 class="hasAnchor">
<a href="#basic-workflow" class="anchor"></a>Basic workflow</h2>
<ol style="list-style-type: decimal">
<li>Register your tokens with <code><a href="reference/register_token.html">register_token()</a></code>.</li>
<li>Add users to the request queue with <code><a href="reference/request.html">request()</a></code>.</li>
<li>Actually get the friendship information with <code><a href="reference/sample_twitter_graph.html">sample_twitter_graph()</a></code>.</li>
<li>Export the graph with <code><a href="reference/get_network_as_tidygraph.html">get_network_as_tidygraph()</a></code>.</li>
</ol>
</div>
<div id="step-1-register-your-tokens" class="section level2">
<h2 class="hasAnchor">
<a href="#step-1-register-your-tokens" class="anchor"></a>Step 1: Register your tokens</h2>
<p>Create a token with <code>rtweet</code> and then register it with <code><a href="reference/register_token.html">register_token()</a></code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(twittercache)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2-3" data-line-number="3">token &lt;-<span class="st"> </span>rtweet<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/rtweet/topics/create_token">create_token</a></span>(</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">  <span class="dt">app =</span> <span class="st">"FILL_THIS_IN"</span>,</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">  <span class="dt">consumer_key =</span> <span class="st">"FILL_THIS_IN"</span>,</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">  <span class="dt">consumer_secret =</span> <span class="st">"FILL_THIS_IN"</span>,</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">  <span class="dt">access_token =</span> <span class="st">"FILL_THIS_IN"</span>,</a>
<a class="sourceLine" id="cb2-8" data-line-number="8">  <span class="dt">access_secret =</span> <span class="st">"FILL_THIS_IN"</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9">)</a>
<a class="sourceLine" id="cb2-10" data-line-number="10"></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="kw"><a href="reference/register_token.html">register_token</a></span>(token)</a></code></pre></div>
<p><code>twittercache</code> is smart and only allows you to register a token once, so don’t worry about accidentally registering the same token multiple times. You can check how many tokens you have registered with</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="reference/get_number_of_tokens.html">get_number_of_tokens</a></span>()</a></code></pre></div>
</div>
<div id="step-2-request-information-on-nodes-in-the-twitter-graph" class="section level2">
<h2 class="hasAnchor">
<a href="#step-2-request-information-on-nodes-in-the-twitter-graph" class="anchor"></a>Step 2: Request information on nodes in the twitter graph</h2>
<p>Request information on Twitter users with <code><a href="reference/request.html">request()</a></code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw"><a href="reference/request.html">request</a></span>(<span class="st">"alexpghayes"</span>)</a></code></pre></div>
<p>You can pass in multiple screen names at once, and you can also request information on all the 1-step neighors of these users by setting <code>neighborhood = TRUE</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">rohe_lab &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"alexpghayes"</span>, <span class="st">"karlrohe"</span>, <span class="st">"krauskae"</span>, <span class="st">"_fchen"</span>,</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">              <span class="st">"JosephineLukito"</span>, <span class="st">"yinizhang2011"</span>)</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="kw"><a href="reference/request.html">request</a></span>(rohe_lab, <span class="dt">neighborhood =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><code><a href="reference/request.html">request()</a></code> <em>does not</em> do any sampling. It just builds a queue of nodes that need to be sampled. <code><a href="reference/request.html">request()</a></code> is smart:</p>
<ul>
<li>If a node is already in the cache, it isn’t added to the queue</li>
<li>Redundant nodes are not added to the queue</li>
<li>Requests for users that don’t exist results in a warning, but otherwise things carry on happily</li>
</ul>
<p>To see the current list of requests, use</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw"><a href="reference/get_requests.html">get_requests</a></span>()</a></code></pre></div>
<p>This can take a second because it involves an API call to convert user IDs (used in internal cache storage) to Twitter handles.</p>
<p>See the reference section for more details about how to manage the request list.</p>
</div>
<div id="step-3-sample-nodes" class="section level2">
<h2 class="hasAnchor">
<a href="#step-3-sample-nodes" class="anchor"></a>Step 3: Sample nodes!</h2>
<p>All you need to do is run</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="reference/sample_twitter_graph.html">sample_twitter_graph</a></span>()</a></code></pre></div>
<p>Really. That’s it. Data about each user is saved into the cache as soon it is received.</p>
<p>If your R session crashes, you lose internet connection, whatever, it doesn’t matter. Just run <code><a href="reference/sample_twitter_graph.html">sample_twitter_graph()</a></code> again and the sampling will pick up right where it left off, automatically updating the request queue for you.</p>
<p>Sampling will automatically use all registered tokens, and will respect rates limits. When we reach an API rate limit, we simply wait for the shortest amount of time until the rate limit resets for the next available token.</p>
<p>On occasion <code>rtweet()</code> or the Twitter API will just explode and won’t be able to sample a node. <code><a href="reference/sample_twitter_graph.html">sample_twitter_graph()</a></code> records these failures and moves on to the next requested node in cases like this. See <code><a href="reference/get_failures.html">get_failures()</a></code> and associated tools for some details on how to handle this.</p>
</div>
<div id="step-4-turn-the-data-into-a-graph" class="section level2">
<h2 class="hasAnchor">
<a href="#step-4-turn-the-data-into-a-graph" class="anchor"></a>Step 4: Turn the data into a graph!</h2>
<p>All you need to do to turn your hard won data into a graph is call:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">graph &lt;-<span class="st"> </span><span class="kw"><a href="reference/get_network_as_tidygraph.html">get_network_as_tidygraph</a></span>()</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">graph</a></code></pre></div>
<p>This can take a hot second. I recommend saving the resulting object as an <code>.rds</code> to facilitate easy use down the line.</p>
<p>Please see the <a href="https://www.data-imaginist.com/2017/introducing-tidygraph/"><code>tidygraph</code></a> blog post for details on how to use <code>tidygraph</code> objects. In particular, you’ll probably want to do some sort of subsetting of nodes and edges.</p>
<p>A useful trick to know is that you can get the adjacency matrix with:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">igraph<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/igraph/topics/as_adjacency_matrix">get.adjacency</a></span>(graph)</a></code></pre></div>
</div>
<div id="frequently-asked-questions" class="section level2">
<h2 class="hasAnchor">
<a href="#frequently-asked-questions" class="anchor"></a>Frequently asked questions</h2>
<p><strong>How do you manage the API rate limits?</strong></p>
<p>Currently we just sample one node a minute. This complies with the Twitter API rate limits, but only if you don’t use the registered tokens for anything else while sampling.</p>
<p><strong>How efficient is this whole process?</strong></p>
<p>We currently sample at about a maximum rate of 60 users / minute. So if you have ~60 or fewer tokens, we sample as fast as possible while respecting the Twitter API rate limits.</p>
<p>We can push this arbritrarily high (provided you have the tokens) by parallelizing a key loop in <code><a href="reference/sample_twitter_graph.html">sample_twitter_graph()</a></code>. I don’t have 60 tokens so I’m not worrying about this yet, but let me know if this is something you need.</p>
<p><strong>Where is the cache itself?</strong></p>
<p>It’s at <code>~/.twittergraph/</code>.</p>
<p><strong>This whole cache thing is a bad idea</strong></p>
<p>Probably, but it works for me.</p>
<p><strong>What about users with big follower counts? Do you sample all the followers?</strong></p>
<p>No. We only sample up to 5,000 friends and 5,000 followers. This is mostly because I’m lazy and also it’s wasteful to spend API calls on someone with tons of followers.</p>
<p>Recall that you can pick up an edge in the network from either node. We recommend trying to make sure the node with smaller degree is in your sample.</p>
<p><strong>What happens when I try to sample protected users?</strong></p>
<p>We remove these users from the sample at export time.</p>
<p><strong>What is this mess of weird logger calls?</strong></p>
<p>If someone knows better practices for logging things, please reach out, I really have no clue what I’m doing here.</p>
</div>
<div id="contributing" class="section level2">
<h2 class="hasAnchor">
<a href="#contributing" class="anchor"></a>Contributing</h2>
<p>Please note that the <code>twittercache</code> project is released with a <a href="CODE_OF_CONDUCT.html">Contributor Code of Conduct</a>.</p>
<p>By contributing to this project, you agree to abide by its terms.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/alexpghayes/twittercache">https://​github.com/​alexpghayes/​twittercache</a>
</li>
<li>Report a bug at <br><a href="https://github.com/alexpghayes/twittercache/issues">https://​github.com/​alexpghayes/​twittercache/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Alex Hayes <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-4985-5160" target="orcid.widget"><img src="https://members.orcid.org/sites/default/files/vector_iD_icon.svg" class="orcid" alt="ORCID" height="16"></a> </li>
</ul>
</div>

      <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.org/alexpghayes/twittercache"><img src="https://travis-ci.org/alexpghayes/twittercache.svg?branch=master" alt="Travis build status"></a></li>
</ul>
</div>
</div>

</div>


      <footer><div class="copyright">
  <p>Developed by Alex Hayes.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
